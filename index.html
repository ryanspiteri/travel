import React, { useState, useEffect } from 'react';
import { Plus, Edit2, Trash2, MapPin, Calendar, DollarSign, Plane, Hotel, Car, Camera, Calculator } from 'lucide-react';

const HolidayPlannerTracker = () => {
  const [trips, setTrips] = useState([
    {
      id: 1,
      name: "Europe Adventure",
      startDate: "2026-07-23",
      endDate: "2026-07-30",
      destinations: [
        {
          id: 1,
          country: "Germany",
          city: "Frankfurt",
          departureDate: "2026-07-23",
          departureTime: "",
          arrivalDate: "",
          arrivalTime: "",
          airline: "",
          flightCost: 0,
          hotel: "",
          hotelCost: 0,
          transport: "",
          transportCost: 0,
          events: "",
          eventCost: 0,
          notes: ""
        },
        {
          id: 2,
          country: "Netherlands",
          city: "Amsterdam",
          departureDate: "",
          departureTime: "",
          arrivalDate: "",
          arrivalTime: "",
          airline: "",
          flightCost: 0,
          hotel: "",
          hotelCost: 0,
          transport: "",
          transportCost: 0,
          events: "",
          eventCost: 0,
          notes: ""
        }
      ]
    }
  ]);

  const [activeTrip, setActiveTrip] = useState(0);
  const [editingDestination, setEditingDestination] = useState(null);

  const addTrip = () => {
    const newTrip = {
      id: Date.now(),
      name: "New Trip",
      startDate: "",
      endDate: "",
      destinations: []
    };
    setTrips([...trips, newTrip]);
    setActiveTrip(trips.length);
  };

  const addDestination = () => {
    const newDestination = {
      id: Date.now(),
      country: "",
      city: "",
      departureDate: "",
      departureTime: "",
      arrivalDate: "",
      arrivalTime: "",
      airline: "",
      flightCost: 0,
      hotel: "",
      hotelCost: 0,
      transport: "",
      transportCost: 0,
      events: "",
      eventCost: 0,
      notes: ""
    };
    
    const updatedTrips = [...trips];
    updatedTrips[activeTrip].destinations.push(newDestination);
    setTrips(updatedTrips);
  };

  const updateDestination = (destId, field, value) => {
    const updatedTrips = [...trips];
    const destIndex = updatedTrips[activeTrip].destinations.findIndex(d => d.id === destId);
    if (destIndex !== -1) {
      updatedTrips[activeTrip].destinations[destIndex][field] = value;
      setTrips(updatedTrips);
    }
  };

  const deleteDestination = (destId) => {
    const updatedTrips = [...trips];
    updatedTrips[activeTrip].destinations = updatedTrips[activeTrip].destinations.filter(d => d.id !== destId);
    setTrips(updatedTrips);
  };

  const updateTrip = (field, value) => {
    const updatedTrips = [...trips];
    updatedTrips[activeTrip][field] = value;
    setTrips(updatedTrips);
  };

  const calculateTotalCost = (destinations) => {
    return destinations.reduce((total, dest) => {
      return total + (dest.flightCost || 0) + (dest.hotelCost || 0) + (dest.transportCost || 0) + (dest.eventCost || 0);
    }, 0);
  };

  const currentTrip = trips[activeTrip] || trips[0];

  return (
    <div className="max-w-7xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
      <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
        <div className="flex items-center justify-between mb-6">
          <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
            <MapPin className="text-indigo-600" />
            Holiday Planning Tracker
          </h1>
          <button
            onClick={addTrip}
            className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
          >
            <Plus size={16} />
            New Trip
          </button>
        </div>

        {/* Trip Selector */}
        <div className="mb-6">
          <div className="flex gap-2 flex-wrap">
            {trips.map((trip, index) => (
              <button
                key={trip.id}
                onClick={() => setActiveTrip(index)}
                className={`px-4 py-2 rounded-lg transition-colors ${
                  index === activeTrip
                    ? 'bg-indigo-600 text-white'
                    : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                }`}
              >
                {trip.name}
              </button>
            ))}
          </div>
        </div>

        {/* Trip Details */}
        {currentTrip && (
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Trip Name</label>
              <input
                type="text"
                value={currentTrip.name}
                onChange={(e) => updateTrip('name', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
              <input
                type="date"
                value={currentTrip.startDate}
                onChange={(e) => updateTrip('startDate', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">End Date</label>
              <input
                type="date"
                value={currentTrip.endDate}
                onChange={(e) => updateTrip('endDate', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
          </div>
        )}

        {/* Budget Summary */}
        {currentTrip && (
          <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-green-800 flex items-center gap-2">
                <Calculator size={20} />
                Budget Summary
              </h3>
              <div className="text-2xl font-bold text-green-700">
                ${calculateTotalCost(currentTrip.destinations).toLocaleString()}
              </div>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 text-sm">
              <div className="text-center">
                <div className="text-gray-600">Flights</div>
                <div className="font-semibold">${currentTrip.destinations.reduce((sum, d) => sum + (d.flightCost || 0), 0).toLocaleString()}</div>
              </div>
              <div className="text-center">
                <div className="text-gray-600">Hotels</div>
                <div className="font-semibold">${currentTrip.destinations.reduce((sum, d) => sum + (d.hotelCost || 0), 0).toLocaleString()}</div>
              </div>
              <div className="text-center">
                <div className="text-gray-600">Transport</div>
                <div className="font-semibold">${currentTrip.destinations.reduce((sum, d) => sum + (d.transportCost || 0), 0).toLocaleString()}</div>
              </div>
              <div className="text-center">
                <div className="text-gray-600">Events</div>
                <div className="font-semibold">${currentTrip.destinations.reduce((sum, d) => sum + (d.eventCost || 0), 0).toLocaleString()}</div>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Destinations */}
      {currentTrip && currentTrip.destinations.map((destination, index) => (
        <div key={destination.id} className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-semibold text-gray-800 flex items-center gap-2">
              <MapPin className="text-red-500" size={20} />
              Destination {index + 1}: {destination.city || 'New Destination'}, {destination.country}
            </h2>
            <button
              onClick={() => deleteDestination(destination.id)}
              className="text-red-600 hover:text-red-800 transition-colors"
            >
              <Trash2 size={16} />
            </button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Country</label>
              <input
                type="text"
                value={destination.country}
                onChange={(e) => updateDestination(destination.id, 'country', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">City</label>
              <input
                type="text"
                value={destination.city}
                onChange={(e) => updateDestination(destination.id, 'city', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Departure Date</label>
              <input
                type="date"
                value={destination.departureDate}
                onChange={(e) => updateDestination(destination.id, 'departureDate', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Departure Time</label>
              <input
                type="time"
                value={destination.departureTime}
                onChange={(e) => updateDestination(destination.id, 'departureTime', e.target.value)}
                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              />
            </div>
          </div>

          {/* Flight Section */}
          <div className="bg-blue-50 rounded-lg p-4 mb-4">
            <h3 className="font-semibold text-blue-800 mb-3 flex items-center gap-2">
              <Plane size={16} />
              Flight Details
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Arrival Date</label>
                <input
                  type="date"
                  value={destination.arrivalDate}
                  onChange={(e) => updateDestination(destination.id, 'arrivalDate', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Arrival Time</label>
                <input
                  type="time"
                  value={destination.arrivalTime}
                  onChange={(e) => updateDestination(destination.id, 'arrivalTime', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Airline</label>
                <input
                  type="text"
                  value={destination.airline}
                  onChange={(e) => updateDestination(destination.id, 'airline', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Flight Cost ($)</label>
                <input
                  type="number"
                  value={destination.flightCost}
                  onChange={(e) => updateDestination(destination.id, 'flightCost', parseFloat(e.target.value) || 0)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          {/* Hotel Section */}
          <div className="bg-purple-50 rounded-lg p-4 mb-4">
            <h3 className="font-semibold text-purple-800 mb-3 flex items-center gap-2">
              <Hotel size={16} />
              Accommodation
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Hotel/Accommodation</label>
                <input
                  type="text"
                  value={destination.hotel}
                  onChange={(e) => updateDestination(destination.id, 'hotel', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Hotel Cost ($)</label>
                <input
                  type="number"
                  value={destination.hotelCost}
                  onChange={(e) => updateDestination(destination.id, 'hotelCost', parseFloat(e.target.value) || 0)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          {/* Transport Section */}
          <div className="bg-green-50 rounded-lg p-4 mb-4">
            <h3 className="font-semibold text-green-800 mb-3 flex items-center gap-2">
              <Car size={16} />
              Local Transport
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Transport Type</label>
                <input
                  type="text"
                  value={destination.transport}
                  onChange={(e) => updateDestination(destination.id, 'transport', e.target.value)}
                  placeholder="e.g., Rental car, Taxi, Train"
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Transport Cost ($)</label>
                <input
                  type="number"
                  value={destination.transportCost}
                  onChange={(e) => updateDestination(destination.id, 'transportCost', parseFloat(e.target.value) || 0)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          {/* Events Section */}
          <div className="bg-red-50 rounded-lg p-4 mb-4">
            <h3 className="font-semibold text-red-800 mb-3 flex items-center gap-2">
              <Camera size={16} />
              Events & Activities
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Events/Activities</label>
                <input
                  type="text"
                  value={destination.events}
                  onChange={(e) => updateDestination(destination.id, 'events', e.target.value)}
                  placeholder="e.g., Museum tours, Shows, Attractions"
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Event Cost ($)</label>
                <input
                  type="number"
                  value={destination.eventCost}
                  onChange={(e) => updateDestination(destination.id, 'eventCost', parseFloat(e.target.value) || 0)}
                  className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-transparent"
                />
              </div>
            </div>
          </div>

          {/* Notes Section */}
          <div className="bg-gray-50 rounded-lg p-4">
            <h3 className="font-semibold text-gray-800 mb-3">Notes</h3>
            <textarea
              value={destination.notes}
              onChange={(e) => updateDestination(destination.id, 'notes', e.target.value)}
              placeholder="Add any additional notes, reminders, or important information..."
              rows="3"
              className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
            />
          </div>
        </div>
      ))}

      {/* Add Destination Button */}
      {currentTrip && (
        <div className="text-center">
          <button
            onClick={addDestination}
            className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 mx-auto transition-colors"
          >
            <Plus size={20} />
            Add Destination
          </button>
        </div>
      )}
    </div>
  );
};

export default HolidayPlannerTracker;